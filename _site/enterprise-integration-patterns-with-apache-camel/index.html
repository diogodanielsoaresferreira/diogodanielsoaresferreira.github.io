<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146324263-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-146324263-1'); </script> <!-- Default Statcounter code for Diogo Ferreira Website https://diogodanielsoaresferreira.github.io/ --> <script type="text/javascript"> var sc_project=12072454; var sc_invisible=1; var sc_security="1b683c07"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script> <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12072454/0/1b683c07/1/" alt="Web Analytics"></a></div></noscript> <!-- End of Statcounter Code --> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Enterprise Integration Patterns With Apache Camel &#8211; Diogo Ferreira webpage</title> <meta name="description" content="Diogo Ferreira personal webpage."> <meta name="keywords" content="apache camel, programming, java, frameworks"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/me.png"> <meta name="twitter:title" content="Enterprise Integration Patterns With Apache Camel"> <meta name="twitter:description" content="Why Apache Camel is awesome when dealing with complex dependencies"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Enterprise Integration Patterns With Apache Camel"> <meta property="og:description" content="Why Apache Camel is awesome when dealing with complex dependencies"> <meta property="og:url" content="http://localhost:4000/enterprise-integration-patterns-with-apache-camel/"> <meta property="og:site_name" content="Diogo Ferreira webpage"> <meta property="og:image" content="http://localhost:4000/assets/img/me.png"> <link rel="canonical" href="http://localhost:4000/enterprise-integration-patterns-with-apache-camel/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Diogo Ferreira webpage Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/assets/img/favicons/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/assets/img/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/assets/img/favicons/favicon-16x16.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <link rel="manifest" href="/site.webmanifest"> <!-- <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-touch-icon.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> --> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/ua2.jpeg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <!-- <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/me.png" alt="Diogo Ferreira webpage photo" class="author-photo"> <h4>Diogo Ferreira webpage</h4> <p>Diogo Ferreira personal webpage.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:diogodsferreira@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://facebook.com/diogodsFerreira" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="http://linkedin.com/in/diogo-ferreira" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://instagram.com/diogodsferreira" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/diogodanielsoaresferreira" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul> --> <!-- /.dl-submenu -->  <li><a href="http://localhost:4000/about/">About me</a></li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Enterprise Integration Patterns With Apache Camel</h1> <h4>17 Jun 2021</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <figure> <a href="/assets/img/camel/camel.jpeg"><img src="/assets/img/camel/camel.jpeg" style="max-width: 80%"></a> <figcaption style="text-align: center">Photo by <a href="https://unsplash.com/@kristianegelund" target="_blank">Kristian Egelund</a> on Unsplash</figcaption> </figure> <p>Hi there! I want to tell you about a great open-source tool that is AWESOME and it does not get the love it deserves: <strong><a href="https://camel.apache.org/">Apache Camel</a></strong>.</p> <p>Apache Camel is an integration framework. What does that mean? Let’s suppose you are working on a project that consumes data from Kafka and RabbitMQ, reads and writes from and to various databases, transforms data, logs everything to files and outputs the processed data to another Kafka topic. You also have to implement the error handling of the service (retries, dead letter channel, etc.) for everything to run flawlessly. It seems hard.</p> <p>Apache Camel helps you to integrate with many components, such as databases, files, brokers, and much more, while keeping the simplicity and promoting <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/">enterprise integration patterns</a>. Let’s see some examples, based on integration patterns. You can find the code in <a href="https://github.com/diogodanielsoaresferreira/apache_camel_demo">this repository</a>.</p> <p>We will start by consuming events from a Kafka topic and output to another one, taking advantage of the <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/EventDrivenConsumer.html">Event-Driven Consumer</a></strong> pattern. The events will be representation of text messages sent by a user.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/0cdbb84d9a038679091c07ae7e5e5387.js"></script> <script src="https://gist.github.com/diogodanielsoaresferreira/0591c76be64e9b131328ad15e2aa771b.js"></script> <p>That’s about it! We also added the log for us to see the message body in the logs. The log argument is passed using the Simple language, an Apache Camel language used to evaluate expressions.</p> <p>Now let’s implement a <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/Filter.html">message filter</a></strong>. This pattern filters out the messages that do not match certain conditions. In our case, we will only process those that have the type “chat”.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/e09cdb48d69e76ab1cb10c4af4bc6104.js"></script> <p>Easy, right? We now unmarshal the message from JSON to the UserMessage POJO to be able to filter by type. We marshal again in JSON before sending it to another Kafka topic.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/0f871fea43680f80ee14406c74e0450e.js"></script> <p>Now suppose we want to store all messages in a file. Besides, for the messages where the emitter is “John Doe”, we want to store them in a different file, for testing purposes. For that, we can use the <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/ContentBasedRouter.html">content-based router</a></strong> pattern.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/35e23fd77e0c7eba5490b3b4b89f95d2.js"></script> <p>If the file already exists, we will append the events and add a newline at the end of each event. For other emitters, we will do the same, but stores them in another file. It does look like an ‘if’ construct, right?</p> <p>We can see a list of “devices” in the event, and we want to log them one by one. How can we do that? Using the <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/Sequencer.html">Splitter</a></strong> pattern, we can iterate through any list. We can do it sequentially or parallelly. Let’s try to do it sequentially in this example.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/09fa1bef4dfeb39f97fc6ce8258177e8.js"></script> <p>We can split by any field that is an Iterable. As you can see, we are using again the Simple language to access the content of the event.</p> <p>Let’s try something harder. We are receiving messages with text from various emitters, but we want to aggregate multiple text messages and create a new message with all messages for an emitter. To do that, we can use the <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/Aggregator.html">Aggregator</a></strong> pattern. The aggregator pattern allows events to be buffered and wait for other events. When another event is received, it can be performed a custom aggregation, based on our needs. A new event is sent when a condition is met. That condition can be based on the number of events received, a timeout, or any other custom condition.</p> <p>In our case, we will create a new POJO that will aggregate the text messages from an emitter. The new event will be sent after 5 seconds of the first event received for the emitter.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/c008156c4f83f1e3c6e7b7aaf90b9546.js"></script> <p>We are using an in-memory aggregation, but we could use other data stores, such as Postgres or Redis. We are using simple language to aggregate the emitter of the message, and we created a custom aggregation strategy, shown below.</p> <p>In the custom aggregation strategy, for the first event (oldExchange==null), we create a new CombinedUserMessage with the text of the message. For all other events, we add the text of the message to the combined event.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/718f4cd50a4d534f9cb165d00fae44d1.js"></script> <p>This is all great, but how do we apply transformations to a field? We now have a combined event, but what was great was if we could somehow process the combined event and turn it into plain text, by combining the multiple elements of the text messages. We can do that using the <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/MessageTranslator.html">Message Translator</a></strong> pattern.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/3e1ab2d97d959d852f8585242d2a0448.js"></script> <script src="https://gist.github.com/diogodanielsoaresferreira/c7a1ed32df2606f554a1a752a228bb76.js"></script> <p>We can call bean functions directly from a Camel Route and perform all the transformations that we need,using plain Java code. Neat!</p> <p>We can see that our Camel Routes are becoming bigger. How do we do if we want, for example, to separate them between files? Two in-memory components that allow us to do that: <strong>Direct</strong> and <strong>SEDA</strong>.</p> <p><strong>Direct</strong> is a synchronous endpoint that works like a call from a route to another route. Let’s use it to separate the route that stores the event in a file.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/a68c674081b169fc5f575a81f846fd19.js"></script> <p>Great! There is another in-memory component that will be useful for us: <strong>SEDA</strong>. SEDA works like Direct but is asynchronous, which means that puts the message in a queue for other thread to process. Let’s use SEDA to decouple the receiving of the message from Kafka from the routes that consume it.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/09731355e56b2a12378237549b44c583.js"></script> <p>Now our routes are much simpler. Suppose we need to perform a periodic task, such as a cleanup. We can take advantage of the <strong>Timer</strong> endpoint. Let’s exemplify it by creating a route that runs every 5 seconds.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/3c17f8dbf10065f55fced89e0638c51c.js"></script> <p>Now that our application is almost ready for production, we have to improve fault tolerance. What happens if, for some reason, a message gets an error while in a route? Let’s implement the <strong><a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/DeadLetterChannel.html">Dead Letter</a></strong> pattern. When there is an error in the route, the message is sent to another Kafka topic, so that later it can be reprocessed.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/6bc2f0623d14fe37058073d6846d95ff.js"></script> <p>And that’s it! The error handler configuration applies to all routes in the class. We send the original message to the topic (the one that was first received in the route). We could also configure retry policies, with timeouts and other common fault tolerance configurations, but as we don’t need it, we will leave it as is.</p> <p>Now that we are reaching the end of this article, I also wanted to show you something: it is possible to configure <strong>REST</strong> endpoints as Camel routes.</p> <script src="https://gist.github.com/diogodanielsoaresferreira/4993e2d298b912e222f586237f5bc783.js"></script> <p>As simple as that! We just configured a GET for the URL /api/hello, to be answered with “Hello World!”. As you can see, Apache Camel is a framework that simplifies the integration with other components, supporting the enterprise integration patterns and making it easier to create data pipelines.</p> <p>I hope you have liked it! Thanks for reading!</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#apache%20camel" title="Pages tagged apache camel" class="tag"><span class="term">apache camel</span></a><a href="http://localhost:4000/tags/#programming" title="Pages tagged programming" class="tag"><span class="term">programming</span></a><a href="http://localhost:4000/tags/#java" title="Pages tagged java" class="tag"><span class="term">java</span></a><a href="http://localhost:4000/tags/#frameworks" title="Pages tagged frameworks" class="tag"><span class="term">frameworks</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/enterprise-integration-patterns-with-apache-camel/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/enterprise-integration-patterns-with-apache-camel/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'diogo-ferreira-webpage'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
